<!doctype html>
<html lang="en">
<head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
 <script>
$( document ).ready(function() {
	//var c = document.getElementById("myCanvas");
	//var cWidth = c.width;
	//var cHeight = c.height;
	//var ctx = c.getContext("2d");
	
	//ctx.moveTo(cWidth/3,cHeight/3);
	//ctx.lineTo(cWidth*2/3,cHeight/3);
	//ctx.lineTo(cWidth*2/3,cHeight*2/3);
	//ctx.lineTo(cWidth/3,cHeight*2/3);
	//ctx.lineTo(cWidth/3,cHeight/3);
	//ctx.stroke();
});
function moar(level) {
	console.log("level: " + level);
	$("#myCanvas").remove()
	$("body").append(
		$('<canvas></canvas>')
		.attr("width","400")
		.attr("height","400")
		.attr("id","myCanvas")
		.css({"border-style":"solid",
			  "border-width":"1px"
			  })
	);

	var c = document.getElementById("myCanvas");
	var ctx = c.getContext("2d");
	
	var startX = c.width/3;
	var startY = c.height*2/3;
	var endX = c.width*2/3;
	var endY = c.width*2/3;
	var xCoordinates = [startX,endX];
	var yCoordinates = [startY, endY];
	//first line
	var XCs = [];
	var YCs = [];
	
	var calcProgress = document.getElementById("calcProgress");
	calcProgress.max = Math.pow(5,level+1);
	calcProgress.value = 0;
	for (i=0; i <= level; i++) {

		for (j=0; j<(xCoordinates.length - 1);j++){
			XCs = XCs.concat(fractilize([xCoordinates[j],xCoordinates[j+1]],[yCoordinates[j],yCoordinates[j+1]],"x"));
			YCs = YCs.concat(fractilize([xCoordinates[j],xCoordinates[j+1]],[yCoordinates[j],yCoordinates[j+1]],"y"));
			
			calcProgress.value += 5;
			console.log("calcProgress.max = " + calcProgress.max);
			console.log("calcProgress.value = " + calcProgress.value);
		}

		xCoordinates = XCs;
		yCoordinates = YCs;
		XCs = [];
		YCs = [];
	}
	var drawProgress = document.getElementById("drawProgress");
	drawProgress.max = Math.pow(5,level+1);
	drawProgress.value = 0;
	for (h=0; h<4; h++){
		ctx.moveTo(startX,startY);
		ctx.beginPath();
		for (i=0; i <xCoordinates.length; i++){
			ctx.lineTo(xCoordinates[i],yCoordinates[i]);
			drawProgress.value += 1
		}
		ctx.stroke();
		ctx.translate(c.width/2, c.width/2);
		ctx.rotate(90*Math.PI/180);
		ctx.translate(-c.width/2, -c.width/2);
	}

	document.getElementById("myButton").setAttribute( "onClick","javascript: moar(" + (level + 1) + ");" );
}
function fractilize(xCoords,yCoords,exitVar){
	//find the direction of the line	
	var newXcoords = [0,1,2,3,4,5];
	var newYcoords = [0,1,2,3,4,5];
	var lineLength;
	var unitDist;
	//first and last items are the same
	newXcoords[0] = xCoords[0];newYcoords[0] = yCoords[0];
	newXcoords[5] = xCoords[1];newYcoords[5] = yCoords[1];
	
	if(xCoords[0] == xCoords[1]){ //x's are the same, line is vertical
		if(yCoords[0] > yCoords[1]){
			//going down
			lineLength = yCoords[0] - yCoords[1];
			unitDist = lineLength / 3;
			
			newXcoords[1] = xCoords[0];
			newXcoords[2] = newXcoords[1] + unitDist;
			newXcoords[3] = newXcoords[2];
			newXcoords[4] = newXcoords[1];
			
			newYcoords[1] = yCoords[0] - unitDist;
			newYcoords[2] = newYcoords[1];
			newYcoords[3] = newYcoords[2] - unitDist;
			newYcoords[4] = newYcoords[3]
		}
		else{
			//going up
			lineLength = yCoords[1] - yCoords[0];
			unitDist = lineLength / 3;
			
			newXcoords[1] = xCoords[0];
			newXcoords[2] = newXcoords[1] - unitDist;
			newXcoords[3] = newXcoords[2];
			newXcoords[4] = newXcoords[1];
			
			newYcoords[1] = yCoords[0] + unitDist;
			newYcoords[2] = newYcoords[1];
			newYcoords[3] = newYcoords[2] + unitDist;
			newYcoords[4] = newYcoords[3];
		}
	}
	else{ //y's are the same, line is horizontal
		if(xCoords[0] > xCoords[1]){
			//going left
			lineLength = xCoords[0] - xCoords[1];
			unitDist = lineLength / 3;
			
			newXcoords[1] = xCoords[0] - unitDist;
			newXcoords[2] = newXcoords[1];
			newXcoords[3] = newXcoords[2] - unitDist;
			newXcoords[4] = newXcoords[3];
			
			newYcoords[1] = yCoords[0];
			newYcoords[2] = newYcoords[1] + unitDist;
			newYcoords[3] = newYcoords[2];
			newYcoords[4] = newYcoords[1];
		}
		else{
			//going right
			lineLength = xCoords[1] - xCoords[0];
			unitDist = lineLength / 3;
			
			newXcoords[1] = xCoords[0] + unitDist;
			newXcoords[2] = newXcoords[1];
			newXcoords[3] = newXcoords[2] + unitDist;
			newXcoords[4] = newXcoords[3];
			
			newYcoords[1] = yCoords[0];
			newYcoords[2] = newYcoords[1] + unitDist;
			newYcoords[3] = newYcoords[2];
			newYcoords[4] = newYcoords[1];
		}
	}
	//return 5 coordates when given 2	
	return ((exitVar=="x")?(newXcoords):(newYcoords));
	
}
</script> 
</head>
<body>
	<input id="myButton" type="button" value="moar" onclick="moar(0)"></input><br> 
	<progress id="calcProgress" style="width:400px">Calculate Progress</progress><br>
	<progress id="drawProgress" style="width:400px">Draw Progress</progress><br>
	<canvas style="border-style:solid;border-width:1px" width="400" height="400" id="myCanvas"></canvas>
	
</body/>
</html>